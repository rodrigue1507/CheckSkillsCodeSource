@model CreateConfirmationSurveyViewModel
@{
    ViewData["Title"] = "Liste des questions";
    Layout = "_Layout";
    int i = 0;
}

@using (Html.BeginForm("SaveSurvey", "Survey", FormMethod.Post))
{
    <div class="container-fluid">
        <div class="container">
            <div class="panel panel-default">
                <div class="panel-heading">Validation du formlaire</div>
                <div class="panel-body">
                    <div class="form-group row">
                        <div class="col-md-2">
                            @Html.DisplayNameFor(m => m.Name)
                        </div>
                        <div class="col-md-10">
                            @Html.TextBoxFor(m => m.Name, new { @class = "form-control js-survey-name" })
                            <small id="nameHelp" class="form-text text-muted">Donner un nom à votre formulaire</small>
                            @Html.ValidationMessageFor(m => m.Name)
                        </div>

                    </div>

                    @foreach (var questionGrouped in Model.SurveySelectedQuestions.GroupBy(q => q.CategoryName))
                    {
                        <h3><span class="label label-info"> @questionGrouped.Key</span></h3>
                        <div class="form-group col-md-12">


                            @foreach (var questionVM in questionGrouped.ToList())
                            {
                                i++;
                                switch (questionVM.TypeName)
                                {
                                    case "Question-Reponse":

                                        <div class="form-group row">
                                            <label>Question @i: </label>@questionVM.Content
                                        </div>
                                        <div class="form-group row">
                                            <textarea class="form-control" readonly rows="4"></textarea>
                                        </div>
                                        break;

                                    case "QCM":

                                        <div class="form-group row">
                                            <label>Question @i: </label>@questionVM.Content
                                        </div>

                                        @foreach (var answer in questionVM.QuestionAnswerList)
                                        {
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" value="" id="answer_@answer.Id">
                                                <label class="form-check-label" for="answer_@answer.Id">
                                                    @answer.AnswerContent
                                                </label>
                                            </div>
                                        }
                                        break;
                                }
                            }
                        </div>

                    }

                </div>
            </div>

            <div class="row">
                <input type="submit" class="btn btn-primary" value="Enregistrer le formulaire" />
                <input class="btn btn-info pull-right js-btn-print-survey" type="button" value="Imprimer le formulaire" />
            </div>

            @for (var q = 0; q < Model.OriginalSurveySelectedQuestions.Count(); q++)
            {
                var question = Model.OriginalSurveySelectedQuestions.ToList()[q];

                @Html.Hidden("OriginalSurveySelectedQuestions", question)
            }
        </div>
    </div>
}

@section Scripts
{
    <script>
        $(".js-btn-print-survey").click(function (item) {
            var surveyName = $(".js-survey-name").val();
            location.href = '@Html.Raw(Url.Action("PrintSurvey", "Survey",new { surveySelectedQuestions = Model.OriginalSurveySelectedQuestions.ToList() }))'
                + '&surveyName='
                + surveyName;
        });

    </script>
}


